function [ShapeFunc, divShapeFunc]= getShapeFunc(p)

[ShapeFunc,DivSF,SF2] = ShapeFuncDivLagrange(order,x)
end

function [ShapeFunc,DivSF,SF2] = ShapeFuncDivLagrange(order,x)
xi = x;
nd = order+1;
ni = length(xi);

xd = 0:(1/order):1;
%
  li = zeros ( ni, nd );
  
  for i = 1 : ni
    for j = 1 : nd
      li(i,j) = prod ( ( xi(i) - xd(1:j-1)  ) ./ ( xd(j) - xd(1:j-1)  ) ) ...
              * prod ( ( xi(i) - xd(j+1:nd) ) ./ ( xd(j) - xd(j+1:nd) ) );
    end
  end
ShapeFunc = li';
  lp = zeros ( ni, nd );
  
  for i = 1 : ni
    for j = 1 : nd

      for j1 = 1 : nd

        if ( j1 ~= j )
          p = 1.0;
          for j2 = 1 : nd
            if ( j2 == j1 )
              p = p / ( xd(j) - xd(j2) );
            elseif ( j2 ~= j )
              p = p * ( xi(i) - xd(j2) ) / ( xd(j) - xd(j2) );
            end
          end
          lp(i,j) = lp(i,j) + p;
        end

      end

    end
  end
 
DivSF = lp';  

SF2 = zeros((order+1),ni);
if order==1
   SF2(:,1) = [0;0]; 
elseif order ==2
    for i = 1:ni
        SF2(:,i) = [2;-4;2]; 
    end
elseif order ==3
    SF2 = [18 - 27*x,45 - 81*x,36 - 81*x,27*x - 9];
    SF2 = SF2';
elseif order ==4
    SF2 = [128*x^2 - 160*x + 140/3,- 512*x^2 + 576*x - 416/3,...
        768*x^2 - 768*x + 152,- 512*x^2 + 448*x - 224/3,...
        128*x^2 - 96*x + 44/3]; 
    SF2 = SF2';
elseif order ==5 
    SF2 = [- (3125*x.^3)/6 + (1875*x.^2)/2 - (2125*x)./4 + 375/4,...
        (15625*x.^3)/6 - 4375*x.^2 + (8875*x)./4 - 1925/6,...
        - (15625*x.^3)/3 + 8125*x.^2 - (7375*x)./2 + 2675/6,...
        (15625*x.^3)/3 - 7500*x.^2 + (6125*x)./2 - 325,...
        - (15625*x.^3)/6 + (6875*x.^2)/2 - (5125*x)./4 + 1525/12,...
        (3125*x.^3)/6 - 625*x.^2 + (875*x)./4 - 125/6]; 
    SF2 = SF2';
elseif order ==6
    SF2 = [0,0,0,0,0,0,0]; 
elseif order ==7
    SF2 = [- (823543*x.^5)/120 + (117649*x.^4)/6 - (386561*x.^3)/18 + (33614*x.^2)/3 - (331681*x)./120 + 22981/90,...
        (5764801*x.^5)/120 - (1058841*x.^4)/8 + (4958065*x.^3)/36 - (266511*x.^2)/4 + (218834*x)./15 - 10927/10,...
        - (5764801*x.^5)/40 + (1529437*x.^4)/4 - (756315*x.^3)/2 + 170471*x.^2 - (1347647*x)./40 + 43071/20,...
        (5764801*x.^5)/24 - (14706125*x.^4)/24 + (20756645*x.^3)/36 - (2926819*x.^2)/12 + (133427*x)./3 - 46501/18,...
        - (5764801*x.^5)/24 + 588245*x.^4 - (9495955*x.^3)/18 + 211288*x.^2 - (872935*x)./24 + 2009,...
        (5764801*x.^5)/40 - (2705927*x.^4)/8 + (1159683*x.^3)/4 - (444185*x.^2)/4 + (91924*x)./5 - 9849/10,...
        - (5764801*x.^5)/100 + (1294139*x.^4)/10 - (319333*x.^3)/3 + (196882*x.^2)/5 - (634207*x)./100 + 49931/150,...
        (823543*x.^5)/120 - (117649*x.^4)/8 + (420175*x.^3)/36 - (16807*x.^2)/4 + (9947*x)./15 - 343/10];
    SF2 = SF2';
end

%SF2 = zeros((order+1),ni);
end
